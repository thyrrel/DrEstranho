# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
# â”ƒ ğŸ”® genesis_ritual.yml - InvocaÃ§Ã£o automÃ¡tica de artefatos e validaÃ§Ã£o mÃ­stica â”ƒ
# â”ƒ ğŸ“œ Estilo byThyrrel | Fluxo Ãºnico | Cache | Seguro | ReutilizÃ¡vel             â”ƒ
# â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

name: Genesis Ritual

on:
  push:
    branches: [Tutor-DemonÃ­aco]
    paths: [recipe/**, bin/genesis.dart]
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

env:
  DART_SDK: 3.5.0

jobs:
  ritual:
    runs-on: ubuntu-latest
    permissions:
      contents: write          # para commitar README
    steps:
      # ---------- 1. PreparaÃ§Ã£o do grimÃ³rio ----------
      - name: ğŸ“œ Checkout do grimÃ³rio
        uses: actions/checkout@v4

      - name: ğŸ¯ Setup Dart ${{ env.DART_SDK }}
        uses: dart-lang/setup-dart@v1
        with:
          sdk: ${{ env.DART_SDK }}

      - name: â™»ï¸ Cache de dependÃªncias
        uses: actions/cache@v4
        with:
          path: ~/.pub-cache
          key: pub-${{ runner.os }}-${{ hashFiles('**/pubspec.yaml') }}
          restore-keys: pub-${{ runner.os }}-

      - name: ğŸ“¦ Instalar dependÃªncias
        run: dart pub get

      # ---------- 2. InvocaÃ§Ã£o ----------
      - name: ğŸ”® Invocar rituais e gerar artefatos
        run: dart run bin/genesis.dart

      # ---------- 3. ValidaÃ§Ã£o & PromoÃ§Ã£o ----------
      - name: ğŸ›¡ï¸ Validar artefatos e promover
        id: validar
        run: |
          set -euo pipefail
          mkdir -p lib/limbo lib/infernus instrumento ritual extraplanar

          SUCCESS_COUNT=0
          echo "## ğŸ”¥ Artefatos conjurados" >> $GITHUB_STEP_SUMMARY

          for f in artefatos/*.dart; do
            [[ -f "$f" ]] || continue
            nome=$(basename "$f" .dart)

            if dart analyze --fatal-infos "$f"; then
              cp "$f" lib/limbo/
              cp "$f" instrumento/ ritual/ extraplanar/
              echo "- $nome" >> README.md
              echo "- âœ… $nome" >> $GITHUB_STEP_SUMMARY
              ((SUCCESS_COUNT++))
            else
              cp "$f" lib/infernus/
              [[ -f recipe/$nome.txt ]] && mv recipe/$nome.txt recipe/${nome}_infernus
              echo "::error file=$f::AnÃ¡lise mÃ­stica falhou para $nome"
              exit 1
            fi
          done

          echo "SUCCESS_COUNT=$SUCCESS_COUNT" >> $GITHUB_OUTPUT

      # ---------- 4. Commit do README atualizado ----------
      - name: ğŸ“„ Commitar README
        if: steps.validar.outputs.SUCCESS_COUNT != '0'
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add README.md
          git diff --cached --quiet || git commit -m "chore: registra artefatos conjurados"
          git push

      # ---------- 5. Arquivo de artefatos aprovados ----------
      - name: ğŸ“¤ Upload de artefatos aprovados
        uses: actions/upload-artifact@v4
        with:
          name: artefatos-aprovados
          path: |
            instrumento/
            ritual/
            extraplanar/

      # ---------- 6. Selo de autenticidade (GPG) ----------
      - name: ğŸ” Assinar artefatos (opcional)
        if: github.ref == 'refs/heads/Tutor-DemonÃ­aco'
        continue-on-error: true
        run: |
          for f artefatos/*.dart; do
            gpg --batch --detach-sign --armor "$f"
          done
          echo "Assinaturas criadas em artefatos/*.asc"

# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
# â”ƒ ğŸ§ª Roadmap futuro (ativa com flags ou issues)                               â”ƒ
# â”ƒ  1. Olho de Agamotto: dart test + cobertura + badge codecov                â”ƒ
# â”ƒ  2. RosÃ¡rio de rollback: tag genesis/<nome>@v<n> em caso de falha          â”ƒ
# â”ƒ  3. CÃ­rculo de aprovaÃ§Ã£o: ambiente protegido para releases crÃ­ticas        â”ƒ
# â”ƒ  4. Espelho dimensional: push para GitHub Packages ou S3                   â”ƒ
# â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

# âœï¸ byThyrrel  
# ğŸ’¡ Workflow selado, cacheado, seguro e com estilo
# ğŸ§ª Ideal para conjuradores exigentes
