# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
# â”ƒ âš™ï¸ genesis.yml - Ritual completo: varredura, geraÃ§Ã£o, teste e invocaÃ§Ã£o   â”ƒ
# â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

name: Genesis Ritual

on:
  push:
    branches:
      - LIMBO
    paths:
      - 'recipe/**'
      - 'bin/genesis.dart'

jobs:
  conjurar_ritual:
    name: ğŸ”® InvocaÃ§Ã£o, ValidaÃ§Ã£o e Destino
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¦ Checkout do grimÃ³rio
        uses: actions/checkout@v3

      - name: ğŸ§™ Instalar Dart
        uses: dart-lang/setup-dart@v1

      - name: ğŸ“¦ Instalar dependÃªncias
        run: dart pub get

      - name: ğŸ”® Varredura e invocaÃ§Ã£o de rituais
        run: |
          rituais=$(find recipe -type f -name '*.txt' ! -name '*infernus.txt' ! -path 'recipe/acervo/*')

          for ritual in $rituais; do
            nome=$(basename "$ritual" .txt)
            artefato="artefatos/$nome.dart"

            echo "ğŸ”§ Gerando artefato para $ritual"
            dart run bin/genesis.dart "$ritual"

            if [ -f "$artefato" ]; then
              echo "ğŸ§ª Testando artefato: $artefato"
              dart analyze "$artefato" || STATUS=falhou

              mkdir -p lib/limbo/
              mkdir -p lib/infernus/

              if [ "$STATUS" = "falhou" ]; then
                mv "$artefato" lib/infernus/
                mv "$ritual" "recipe/acervo/${nome}_infernus"
                echo "âŒ Ritual reprovado: artefato â†’ infernus, ritual renomeado"
              else
                mv "$artefato" lib/limbo/
                echo "âœ… Ritual aprovado: artefato â†’ limbo"
                echo "ğŸš€ Invocando workflow do artefato: $nome"
                gh workflow run "artefato-${nome}.yml" --ref LIMBO
              fi
            else
              echo "âš ï¸ Nenhum artefato gerado para $nome"
            fi
