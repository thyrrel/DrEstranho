# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
# â”ƒ âš™ï¸ genesis.yml - Ritual completo: invocaÃ§Ã£o, validaÃ§Ã£o e destinaÃ§Ã£o final â”ƒ
# â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

name: Genesis Ritual

on:
  push:
    paths:
      - 'Tutor-DemonÃ­aco/recipes/**'
      - 'bin/genesis.dart'

jobs:
  invocacao:
    name: ğŸ”® InvocaÃ§Ã£o dos Rituais
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¦ Checkout do grimÃ³rio
        uses: actions/checkout@v3

      - name: ğŸ§™ Instalar Dart
        uses: dart-lang/setup-dart@v1

      - name: ğŸ“¦ Instalar dependÃªncias
        run: dart pub get

      - name: ğŸ” Varrer rituais .txt vÃ¡lidos
        id: rituais
        run: |
          arquivos=$(find Tutor-DemonÃ­aco/recipes -type f -name '*.txt' ! -name '*infernus.txt' ! -name '*acervo.txt')
          echo "arquivos<<EOF" >> $GITHUB_OUTPUT
          echo "$arquivos" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

      - name: ğŸ”® Executar rituais
        run: |
          for ritual in ${{ steps.rituais.outputs.arquivos }}; do
            nome=$(basename "$ritual" .txt)
            artefato="artefatos/$nome.dart"

            echo "ğŸ”§ Gerando artefato para $ritual"
            dart run bin/genesis.dart "$ritual"

            if [ -f "$artefato" ]; then
              echo "ğŸ§ª Testando artefato: $artefato"
              dart analyze "$artefato" || STATUS=falhou

              mkdir -p LIMBO/lib/limbo/
              mkdir -p LIMBO/lib/infernus/

              if [ "$STATUS" = "falhou" ]; then
                mv "$artefato" LIMBO/lib/infernus/
                mv "$ritual" "Tutor-DemonÃ­aco/recipes/${nome}infernus.txt"
                echo "âŒ Ritual reprovado: $nome â†’ infernus"
              else
                mv "$artefato" LIMBO/lib/limbo/
                echo "âœ… Ritual aprovado: $nome â†’ limbo"

                tipo=$(grep "^tipo:" "$ritual" | cut -d':' -f2 | tr -d ' ')
                echo "ğŸš€ Invocando destino final: $tipo"

                case "$tipo" in
                  instrumento)
                    git checkout Instrumentos-MÃ¡gicos
                    mkdir -p lib/instrumentos/
                    mv "LIMBO/lib/limbo/$nome.dart" lib/instrumentos/
                    ;;
                  grimorio)
                    git checkout GRIMORIO
                    mkdir -p lib/grimorio/
                    mv "LIMBO/lib/limbo/$nome.dart" lib/grimorio/
                    ;;
                  extraplanar)
                    git checkout ExtraPlanares
                    mkdir -p lib/extraplanares/
                    mv "LIMBO/lib/limbo/$nome.dart" lib/extraplanares/
                    ;;
                  *)
                    echo "âš ï¸ Tipo desconhecido: $tipo"
                    ;;
                esac

                git add .
                git commit -m "Artefato $nome promovido para $tipo"
                git push

                mkdir -p Tutor-DemonÃ­aco/recipes/acervo/
                mv "$ritual" "Tutor-DemonÃ­aco/recipes/acervo/${nome}acervo.txt"
                echo "ğŸ“ Ritual arquivado: ${nome}acervo.txt"
              fi
            else
              echo "âš ï¸ Nenhum artefato gerado para $nome"
            fi
          done
