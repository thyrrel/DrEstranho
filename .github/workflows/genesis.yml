# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
# â”ƒ ğŸ”® genesis.yml - InvocaÃ§Ã£o automÃ¡tica de artefatos e validaÃ§Ã£o mÃ­stica     â”ƒ
# â”ƒ ğŸ“œ Estilo byThyrrel | Fluxo completo | Mobile-friendly                      â”ƒ
# â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

name: Genesis Ritual

on:
  push:
    branches:
      - Tutor-DemonÃ­aco
      - main
      - master
    paths:
      - "recipe/**"
      - "bin/genesis.dart"
      - "pubspec.yaml"
  workflow_dispatch:
    inputs:
      force_generation:
        description: 'ForÃ§ar geraÃ§Ã£o de artefatos'
        required: false
        default: 'false'

env:
  DART_SDK_VERSION: '3.2.0'

jobs:
  genesis_ritual:
    name: ğŸ”® Genesis Ritual
    runs-on: ubuntu-latest
    permissions:
      contents: write
      actions: read

    steps:
      - name: ğŸ“¦ Checkout do grimÃ³rio
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ§™ Instalar Dart SDK
        uses: dart-lang/setup-dart@v1
        with:
          sdk: ${{ env.DART_SDK_VERSION }}

      - name: ğŸ“‹ Verificar estrutura do projeto
        run: |
          echo "ğŸ” Verificando estrutura do projeto..."
          ls -la
          echo ""
          echo "ğŸ“ ConteÃºdo da pasta recipe (se existir):"
          if [ -d "recipe" ]; then
            find recipe -type f -name "*.txt" | head -10
          else
            echo "âš ï¸ Pasta recipe nÃ£o encontrada"
          fi
          echo ""
          echo "ğŸ“„ Verificando pubspec.yaml:"
          if [ -f "pubspec.yaml" ]; then
            echo "âœ… pubspec.yaml encontrado"
          else
            echo "âŒ pubspec.yaml nÃ£o encontrado"
          fi

      - name: ğŸ“¦ Instalar dependÃªncias
        run: |
          echo "ğŸ”„ Instalando dependÃªncias..."
          dart pub get
          echo "âœ… DependÃªncias instaladas"

      - name: ğŸ—ï¸ Criar estruturas necessÃ¡rias
        run: |
          echo "ğŸ—ï¸ Criando diretÃ³rios necessÃ¡rios..."
          mkdir -p artefatos lib/limbo lib/infernus
          mkdir -p instrumento ritual extraplanar
          
          # Criar recipe se nÃ£o existir com ritual de exemplo
          if [ ! -d "recipe" ]; then
            echo "ğŸ“ Criando pasta recipe com ritual de exemplo..."
            mkdir -p recipe
            cat > recipe/exemplo_ritual.txt << 'EOF'
          Bem-vindo ao GrimÃ³rio Tutor-DemonÃ­aco
          Este Ã© um ritual de exemplo
          Cada linha aqui vira um comando no artefato
          VocÃª pode criar seus prÃ³prios rituais
          Apenas adicione arquivos .txt na pasta recipe
          EOF
            echo "ğŸ“ Ritual de exemplo criado"
          fi

      - name: ğŸ”® Invocar rituais e gerar artefatos
        id: generate_artifacts
        run: |
          echo "ğŸ”® Iniciando geraÃ§Ã£o de artefatos..."
          dart run bin/genesis.dart
          
          # Verificar se artefatos foram gerados
          if [ -d "artefatos" ] && [ "$(find artefatos -name '*.dart' | wc -l)" -gt 0 ]; then
            echo "artifacts_count=$(find artefatos -name '*.dart' | wc -l)" >> $GITHUB_OUTPUT
            echo "artifacts_generated=true" >> $GITHUB_OUTPUT
            echo "âœ… Artefatos gerados com sucesso!"
            echo "ğŸ“Š Total: $(find artefatos -name '*.dart' | wc -l) artefatos"
          else
            echo "artifacts_generated=false" >> $GITHUB_OUTPUT
            echo "artifacts_count=0" >> $GITHUB_OUTPUT
            echo "âš ï¸ Nenhum artefato foi gerado"
          fi

      - name: ğŸ“¦ Mover artefatos para LIMBO
        if: steps.generate_artifacts.outputs.artifacts_generated == 'true'
        run: |
          echo "ğŸ“¦ Movendo artefatos para lib/limbo..."
          find artefatos -name "*.dart" -exec cp {} lib/limbo/ \;
          echo "âœ… Artefatos movidos para LIMBO"

      - name: ğŸ§ª Validar artefatos
        if: steps.generate_artifacts.outputs.artifacts_generated == 'true'
        id: validate
        run: |
          echo "ğŸ§ª Validando artefatos..."
          validation_passed=true
          failed_count=0
          
          for arquivo in artefatos/*.dart; do
            if [ -f "$arquivo" ]; then
              nome=$(basename "$arquivo" .dart)
              echo "ğŸ” Validando: $nome"
              
              if dart analyze "$arquivo" --fatal-infos; then
                echo "âœ… $nome passou na validaÃ§Ã£o"
              else
                echo "âŒ $nome falhou na validaÃ§Ã£o"
                validation_passed=false
                failed_count=$((failed_count + 1))
                
                # Mover para infernus
                cp "$arquivo" lib/infernus/
                
                # Mover recipe original se existir
                if [ -f "recipe/$nome.txt" ]; then
                  mv "recipe/$nome.txt" "recipe/${nome}_infernus.txt"
                fi
              fi
            fi
          done
          
          echo "validation_passed=$validation_passed" >> $GITHUB_OUTPUT
          echo "failed_count=$failed_count" >> $GITHUB_OUTPUT
          
          if [ "$validation_passed" = "true" ]; then
            echo "ğŸ‰ Todas as validaÃ§Ãµes passaram!"
          else
            echo "âš ï¸ $failed_count artefatos falharam na validaÃ§Ã£o"
          fi

      - name: âœ… Editar conjurafor.yml
        if: steps.validate.outputs.validation_passed == 'true'
        run: |
          echo "âœ… Atualizando conjurafor.yml..."
          mkdir -p .github/workflows
          
          timestamp=$(date '+%Y-%m-%d %H:%M:%S UTC')
          cat >> .github/workflows/conjurafor.yml << EOF
          # ğŸ”® Artefato adicionado automaticamente em $timestamp
          # ğŸ“Š Total de artefatos validados: ${{ steps.generate_artifacts.outputs.artifacts_count }}
          
          EOF
          echo "ğŸ“ conjurafor.yml atualizado"

      - name: ğŸª„ Promover artefatos validados
        if: steps.validate.outputs.validation_passed == 'true'
        run: |
          echo "ğŸª„ Promovendo artefatos para dimensÃµes finais..."
          
          # Copiar para todas as dimensÃµes
          find artefatos -name "*.dart" -exec cp {} instrumento/ \;
          find artefatos -name "*.dart" -exec cp {} ritual/ \;
          find artefatos -name "*.dart" -exec cp {} extraplanar/ \;
          
          echo "âœ… Artefatos promovidos para todas as dimensÃµes!"

      - name: ğŸ“ Atualizar README
        if: steps.validate.outputs.validation_passed == 'true'
        run: |
          echo "ğŸ“ Atualizando README.md..."
          
          echo "" >> README.md
          echo "## ğŸ”® Artefatos Gerados - $(date '+%Y-%m-%d %H:%M:%S')" >> README.md
          echo "" >> README.md
          
          for arquivo in artefatos/*.dart; do
            if [ -f "$arquivo" ]; then
              nome=$(basename "$arquivo" .dart)
              echo "- âœ… **$nome** - Ritual validado e promovido" >> README.md
            fi
          done
          
          echo "" >> README.md
          echo "ğŸ“Š **Total de artefatos ativos**: ${{ steps.generate_artifacts.outputs.artifacts_count }}" >> README.md
          echo "" >> README.md

      - name: ğŸš€ Commit e deploy das mudanÃ§as
        if: steps.validate.outputs.validation_passed == 'true'
        run: |
          echo "ğŸš€ Fazendo commit das mudanÃ§as..."
          
          git config --global user.name "Genesis Ritual Bot"
          git config --global user.email "genesis@grimorio-tutor-demoniaco.dev"
          git config --global user.signingkey ""
          git config --global commit.gpgsign false
          
          git add .
          
          commit_msg="ğŸ”® Genesis Ritual: ${{ steps.generate_artifacts.outputs.artifacts_count }} artefatos validados e promovidos

          ğŸ§™ Ritual executado automaticamente
          ğŸ“Š Artefatos gerados: ${{ steps.generate_artifacts.outputs.artifacts_count }}
          âœ… ValidaÃ§Ã£o: ${{ steps.validate.outputs.validation_passed }}
          ğŸ“… Timestamp: $(date '+%Y-%m-%d %H:%M:%S UTC')
          
          DimensÃµes atualizadas:
          - ğŸ“¦ LIMBO (lib/limbo/)
          - ğŸ§ª ValidaÃ§Ã£o concluÃ­da
          - ğŸª„ Instrumentos MÃ¡gicos (instrumento/)
          - ğŸ“œ Rituais (ritual/)
          - ğŸŒŒ ExtraPlanares (extraplanar/)"
          
          if git commit -m "$commit_msg"; then
            echo "âœ… Commit realizado com sucesso"
            if git push; then
              echo "ğŸš€ Push realizado com sucesso"
            else
              echo "âš ï¸ Falha no push, mas commit local foi realizado"
            fi
          else
            echo "â„¹ï¸ Nenhuma mudanÃ§a para fazer commit"
          fi

      - name: ğŸ“Š RelatÃ³rio final
        if: always()
        run: |
          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ”® RELATÃ“RIO FINAL DO GENESIS RITUAL"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "ğŸ“Š EstatÃ­sticas:"
          echo "   ğŸ§± Artefatos gerados: ${{ steps.generate_artifacts.outputs.artifacts_count || '0' }}"
          echo "   âœ… ValidaÃ§Ã£o passou: ${{ steps.validate.outputs.validation_passed || 'N/A' }}"
          echo "   âŒ ValidaÃ§Ãµes falhas: ${{ steps.validate.outputs.failed_count || '0' }}"
          echo ""
          echo "ğŸ“ Estrutura final:"
          if [ -d "artefatos" ]; then
            echo "   ğŸ”® artefatos/: $(find artefatos -name '*.dart' | wc -l) arquivos"
          fi
          if [ -d "lib/limbo" ]; then
            echo "   ğŸ“¦ lib/limbo/: $(find lib/limbo -name '*.dart' | wc -l) arquivos"
          fi
          if [ -d "lib/infernus" ]; then
            echo "   ğŸ”¥ lib/infernus/: $(find lib/infernus -name '*.dart' | wc -l) arquivos"
          fi
          echo ""
          echo "ğŸ‰ Ritual Genesis concluÃ­do!"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

# âœï¸ byThyrrel | Workflow otimizado para GitHub mobile
# ğŸ”® Sistema completo de geraÃ§Ã£o, validaÃ§Ã£o e promoÃ§Ã£o de artefatos
# ğŸ“± Funciona 100% via navegador, sem necessidade de CLI
