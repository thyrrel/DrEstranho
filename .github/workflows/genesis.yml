# ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
# ┃ ⚙️ genesis.yml - Ritual inicial: geração e validação de artefatos         ┃
# ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

name: Genesis Ritual

on:
  push:
    branches:
      - Tutor-Demoníaco
    paths:
      - 'recipe/**'
      - 'bin/genesis.dart'
  workflow_dispatch:

jobs:
  conjurar_ritual:
    name: 🔮 Invocação e Validação Inicial
    runs-on: ubuntu-latest

    steps:
      - name: 📦 Checkout do grimório
        uses: actions/checkout@v3

      - name: 🧙 Instalar Dart
        uses: dart-lang/setup-dart@v1

      - name: 📦 Instalar dependências
        run: dart pub get

      - name: 🔮 Varredura e invocação de rituais
        run: |
          rituais=$(find recipe -type f -name '*.txt' ! -name '*infernus.txt' ! -path 'recipe/acervo/*')

          for ritual in $rituais; do
            nome=$(basename "$ritual" .txt)
            artefato="artefatos/$nome.dart"

            echo "🔧 Gerando artefato para $ritual"
            dart run bin/genesis.dart "$ritual"

            if [ -f "$artefato" ]; then
              echo "🧪 Testando artefato: $artefato"
              dart analyze "$artefato" || STATUS=falhou

              echo "📦 Artefato gerado: $artefato"
              echo "📌 Status: ${STATUS:-aprovado}"
            else
              echo "⚠️ Nenhum artefato gerado para $nome"
            fi
