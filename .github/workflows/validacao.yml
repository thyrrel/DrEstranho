# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
# â”ƒ ğŸ”® limbo.yml â€“ Detecta chegada de artefato em lib/limbo/*.dart              â”ƒ
# â”ƒ ğŸ“œ byThyrrel | VisÃ­vel na lista | Roda sÃ³ quando push em LIMBO              â”ƒ
# â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
name: Limbo Ritual

on:
  push:
    branches: [LIMBO]
    paths: [lib/limbo/*.dart]

permissions:
  contents: write

jobs:
  chegada:
    name: Chegada
    runs-on: ubuntu-latest
    steps:
      - name: Checkout LIMBO
        uses: actions/checkout@v4
        with:
          ref: LIMBO

      - name: Instalar Dart
        uses: dart-lang/setup-dart@v1

      - name: Detectar artefatos novos
        id: detect
        run: |
          # Arquivos que acabaram de chegar
          mapfile -t files < <(git diff --name-only HEAD~1..HEAD | grep '^lib/limbo/.*\.dart$' || true)
          [ ${#files[@]} -eq 0 ] && echo "Nenhum artefato novo" && exit 0
          printf '%s\n' "${files[@]}" > artefatos.txt
          echo "Artefatos detectados:"
          cat artefatos.txt

      - name: Validar artefato
        run: |
          while IFS= read -r f; do
            [ -f "$f" ] || continue
            echo "ğŸ” Analisando $f"
            if ! dart analyze --fatal-infos "$f"; then
              echo "âŒ $f falhou â€“ movendo para infernus"
              mv "$f" lib/infernus/
              nome=$(basename "$f" .dart)
              echo "- $nome (infernus: $(date))" >> README.md
            else
              echo "âœ… $f aprovado"
            fi
          done < artefatos.txt

      - name: Commitar resultados
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: 'ğŸ”® Limbo: validaÃ§Ã£o concluÃ­da'
          branch: LIMBO
