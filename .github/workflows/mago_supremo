# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
# â”ƒ ğŸ§™ mago_supremo.yml - Ritual Completo de InvocaÃ§Ã£o e ObservaÃ§Ã£o           â”ƒ
# â”ƒ ğŸ“ GitHub Web | Mobile Friendly | 4 linhas de visualizaÃ§Ã£o               â”ƒ
# â”ƒ ğŸ”® {nome}.txt â†’ Olho â†’ Recipes â†’ ObservaÃ§Ã£o â†’ RamificaÃ§Ã£o HierÃ¡rquica    â”ƒ
# â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

name: Mago Supremo

on:
  workflow_dispatch:
    inputs:
      invocacao:
        description: "ğŸ“œ Cole o ritual com a tag {nome}.txt (4 linhas visÃ­veis)"
        required: true
        type: string
        default: |

permissions:
  contents: write

jobs:
  invocacao-consagrada:
    name: "ğŸ§¿ InvocaÃ§Ã£o Consagrada"
    runs-on: ubuntu-latest
    outputs:
      nome_artefato: ${{ steps.extrair.outputs.nome }}
      conteudo_reescrito: ${{ steps.extrair.outputs.conteudo }}
    steps:
      - name: ğŸ” Extrair nome do artefato
        id: extrair
        run: |
          # Extrai o nome do {nome}.txt
          TEXTO_COMPLETO='${{ github.event.inputs.invocacao }}'
          echo "ğŸ”® Texto recebido:"
          echo "$TEXTO_COMPLETO"
          
          # Regex para encontrar {nome}.txt
          if [[ "$TEXTO_COMPLETO" =~ \{(.+)\.txt\} ]]; then
            NOME_ARTEFATO="${BASH_REMATCH[1]}"
            echo "âœ… Nome extraÃ­do: $NOME_ARTEFATO"
          else
            NOME_ARTEFATO="artefato_$(date +%s)"
            echo "âš ï¸  Nome nÃ£o encontrado, usando: $NOME_ARTEFATO"
          fi
          
          # Simular reescrita pelo Olho (bin/olhodeagamoto.dart)
          CONTEUDO_REESCRITO="ğŸ§¿ **CONTEÃšDO RESSUSCITADO PELO OLHO**\n\n$TEXTO_COMPLETO\n\nâœ¨ Transformado pelo Olho de Agamoto Ã s $(date)"
          
          echo "nome=$NOME_ARTEFATO" >> $GITHUB_OUTPUT
          echo "conteudo<<EOF" >> $GITHUB_OUTPUT
          echo -e "$CONTEUDO_REESCRITO" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

      - name: ğŸ“– Escrever na Branch Tutor-DemonÃ­aco
        uses: actions/github-script@v7
        with:
          script: |
            const nome = '${{ steps.extrair.outputs.nome }}';
            const conteudo = `${{ steps.extrair.outputs.conteudo }}`;
            
            try {
              await github.rest.repos.createOrUpdateFileContents({
                owner: context.repo.owner,
                repo: context.repo.repo,
                path: `recipes/${nome}.txt`,
                message: `ğŸ“œ Artefato ${nome} consagrado pelo Olho`,
                content: Buffer.from(conteudo).toString('base64'),
                branch: 'Tutor-DemonÃ­aco'
              });
              console.log(`âœ… Artefato ${nome} escrito em recipes/`);
            } catch (error) {
              console.log('âŒ Erro ao escrever artefato:', error);
              throw error;
            }

  observando:
    name: "ğŸ‘ï¸ Observando"
    runs-on: ubuntu-latest
    needs: invocacao-consagrada
    outputs:
      artefatos_falhos: ${{ steps.verificar.outputs.falhos }}
      artefatos_instrumentos: ${{ steps.verificar.outputs.instrumentos }}
      artefatos_grimorio: ${{ steps.verificar.outputs.grimorio }}
      artefatos_extraplanares: ${{ steps.verificar.outputs.extraplanares }}
    steps:
      - name: ğŸ” Verificar Todas as DimensÃµes
        id: verificar
        run: |
          # Simular verificaÃ§Ã£o do artefato em todas as etapas
          NOME_ARTEFATO='${{ needs.invocacao-consagrada.outputs.nome_artefato }}'
          echo "ğŸ‘ï¸ Observando trajetÃ³ria do artefato: $NOME_ARTEFATO"
          
          # Simular verificaÃ§Ã£o em LIMBO (se falhar)
          echo "ğŸ” Verificando LIMBO..."
          FALHOS="[]"
          INSTRUMENTOS="[]" 
          GRIMORIO="[]"
          EXTRAPLANARES="[]"
          
          # LÃ³gica de observaÃ§Ã£o - simulaÃ§Ã£o
          # Se o artefato parar em qualquer ponto antes do destino
          if [ $(($RANDOM % 3)) -eq 0 ]; then
            echo "âŒ Artefato preso no LIMBO"
            FALHOS="[\"$NOME_ARTEFATO\"]"
          else
            echo "âœ… Artefato passou pelo LIMBO"
            
            # Verificar se chegou em Instrumentos-Magicos
            if [ $(($RANDOM % 2)) -eq 0 ]; then
              echo "ğŸµ Artefato chegou em Instrumentos-Magicos"
              INSTRUMENTOS="[\"$NOME_ARTEFATO\"]"
            fi
            
            # Verificar se chegou em GRIMORIO  
            if [ $(($RANDOM % 2)) -eq 0 ]; then
              echo "ğŸ“– Artefato chegou em GRIMORIO"
              GRIMORIO="[\"$NOME_ARTEFATO\"]"
            fi
            
            # Verificar se chegou em ExtraPlanares
            if [ $(($RANDOM % 2)) -eq 0 ]; then
              echo "ğŸª Artefato chegou em ExtraPlanares"
              EXTRAPLANARES="[\"$NOME_ARTEFATO\"]"
            fi
          fi
          
          echo "falhos=$FALHOS" >> $GITHUB_OUTPUT
          echo "instrumentos=$INSTRUMENTOS" >> $GITHUB_OUTPUT
          echo "grimorio=$GRIMORIO" >> $GITHUB_OUTPUT
          echo "extraplanares=$EXTRAPLANARES" >> $GITHUB_OUTPUT

  falha-invocacao:
    name: "âŒ Falha na InvocaÃ§Ã£o"
    runs-on: ubuntu-latest
    needs: observando
    if: ${{ fromJson(needs.observando.outputs.artefatos_falhos) != '[]' }}
    steps:
      - name: ğŸš¨ Registrar Falha
        run: |
          echo "âŒ ARTEFATO PRESO NO LIMBO"
          echo "Artefato: ${{ fromJson(needs.observando.outputs.artefatos_falhos)[0] }}"
          echo "Tempo: $(date)"
          echo "LocalizaÃ§Ã£o: lib/limbo/"
          echo "Status: InvocaÃ§Ã£o Interrompida"

  instrumentos-magicos:
    name: "ğŸ¶ Instrumentos-Magicos"
    runs-on: ubuntu-latest
    needs: observando
    if: ${{ fromJson(needs.observando.outputs.artefatos_instrumentos) != '[]' }}
    strategy:
      matrix:
        artefato: ${{ fromJson(needs.observando.outputs.artefatos_instrumentos) }}
    steps:
      - name: â³ Aguardando Empoderamento
        run: echo "ğŸµ Artefato ${{ matrix.artefato }} aguardando empoderamento..."
        
      - name: ğŸ›¡ï¸ Empoderar
        run: |
          echo "âœ¨ EMPODERANDO ARTEFATO: ${{ matrix.artefato }}"
          echo "Local: Instrumentos-Magicos/instrumentos/"
          echo "Processo: InfusÃ£o de energia arcana"
          echo "Status: Em progresso..."

  grimorio:
    name: "ğŸ“– GRIMORIO"
    runs-on: ubuntu-latest
    needs: observando
    if: ${{ fromJson(needs.observando.outputs.artefatos_grimorio) != '[]' }}
    strategy:
      matrix:
        artefato: ${{ fromJson(needs.observando.outputs.artefatos_grimorio) }}
    steps:
      - name: â³ Aguardando ConjuraÃ§Ã£o
        run: echo "ğŸ“– Artefato ${{ matrix.artefato }} aguardando conjuraÃ§Ã£o..."
        
      - name: ğŸ”® Conjurar
        run: |
          echo "ğŸ”® CONJURANDO ARTEFATO: ${{ matrix.artefato }}"
          echo "Local: GRIMORIO/rituais/"
          echo "Processo: AtivaÃ§Ã£o de runas ancestrais"
          echo "Status: Encantamento em andamento..."

  extraplanares:
    name: "ğŸª ExtraPlanares"
    runs-on: ubuntu-latest
    needs: observando
    if: ${{ fromJson(needs.observando.outputs.artefatos_extraplanares) != '[]' }}
    strategy:
      matrix:
        artefato: ${{ fromJson(needs.observando.outputs.artefatos_extraplanares) }}
    steps:
      - name: â³ Aguardando TranscendÃªncia
        run: echo "ğŸª Artefato ${{ matrix.artefato }} aguardando transcendÃªncia..."
        
      - name: ğŸŒŒ Transcender
        run: |
          echo "ğŸŒŒ TRANSCENDENDO ARTEFATO: ${{ matrix.artefato }}"
          echo "Local: ExtraPlanares/extraplanar/"
          echo "Processo: AscensÃ£o dimensional"
          echo "Status: ConexÃ£o interdimensional estabelecida..."
