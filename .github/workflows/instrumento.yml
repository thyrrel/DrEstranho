# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
# â”ƒ ğŸ”® instrumentos-magicos.yml â€“ Ritual da branch Instrumentos-MÃ¡gicos        â”ƒ
# â”ƒ ğŸ“œ Invoca artefatos em instrumentos/, registra no README.md               â”ƒ
# â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
name: Instrumentos MÃ¡gicos

on:
  workflow_dispatch:
  push:
    branches: [Instrumentos-MÃ¡gicos]
    paths:
      - instrumentos/*.dart
      - .github/workflows/instrumentos-magicos.yml

permissions:
  contents: write

jobs:
  execucao:
    name: ExecuÃ§Ã£o de Instrumento
    runs-on: ubuntu-latest
    steps:
      - name: Checkout da branch Instrumentos-MÃ¡gicos
        uses: actions/checkout@v4
        with:
          ref: Instrumentos-MÃ¡gicos

      - name: Instalar Dart
        uses: dart-lang/setup-dart@v1

      - name: Detectar instrumentos
        run: |
          echo "=== Instrumentos detectados ==="
          find instrumentos -maxdepth 1 -type f -name '*.dart' | sort
          echo "==============================="

      - name: Invocar Ãºltimo instrumento
        run: |
          ultimo=$(find instrumentos -maxdepth 1 -type f -name '*.dart' | sort | tail -n 1)
          echo "âœ¨ Invocando: $ultimo"
          dart run "$ultimo" || echo "// falha ignorada"

      - name: Registrar no README.md
        run: |
          nome=$(basename $(find instrumentos -maxdepth 1 -type f -name '*.dart' | sort | tail -n 1) .dart)
          sed -i "/## Instrumentos/a - $nome" README.md

      - name: Commit automÃ¡tico
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Instrumento invocado: $nome"
          branch: Instrumentos-MÃ¡gicos
          file_pattern: README.md
          commit_user_name: ritual-bot
          commit_user_email: ritual@bot.com
