name: 🌌 Genesis - Criação e Validação de Rituais

on:
  workflow_dispatch:

jobs:
  tutor:
    name: 🧙‍♂️ Tutor-Demoniaco - Processar Recipes
    runs-on: ubuntu-latest
    steps:
      - name: Checkout do repositório
        uses: actions/checkout@v3

      - name: Configurar Git
        run: |
          git config user.name "Tutor-Demoniaco"
          git config user.email "ritual@vdf.com"

      - name: Processar arquivos em recipes/
        run: |
          for file in Tutor-Demoniaco/recipes/*.txt; do
            nome=$(grep '^nome:' "$file" | cut -d':' -f2 | xargs)
            tipo=$(grep '^tipo:' "$file" | cut -d':' -f2 | xargs)
            descricao=$(grep '^descricao:' "$file" | cut -d':' -f2- | xargs)

            echo "🔧 Criando artefato: $nome ($tipo)"
            echo "📜 Descrição: $descricao"

            # Criar arquivo Dart
            mkdir -p instrumentos_magicos
            echo "void main() => print('Executando $nome: $descricao');" > instrumentos_magicos/$nome.dart

            # Criar workflow de validação
            mkdir -p .github/workflows
            cat <<EOF > .github/workflows/$nome.yml
name: 🔥 $nome - Validação em LIMBO

on:
  push:
    branches:
      - LIMBO

jobs:
  testar-$nome:
    name: 🧪 Testar $nome
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Instalar Dart
        uses: dart-lang/setup-dart@v1
      - name: Executar $nome.dart
        run: dart instrumentos_magicos/$nome.dart
EOF

            # Mover para LIMBO
            git checkout LIMBO
            git pull origin LIMBO
            git add instrumentos_magicos/$nome.dart .github/workflows/$nome.yml
            git commit -m "✨ Ritual $nome criado pelo Tutor e enviado para LIMBO"
            git push origin LIMBO
          done
