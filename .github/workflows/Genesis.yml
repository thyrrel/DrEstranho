# ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
# ┃ 🧠 Genesis.yml - Ritual de geração e avaliação de artefatos mágicos        ┃
# ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

name: Genesis Ritual

on:
  push:
    paths:
      - recipes/**
      - lib/tutor/**
      - bin/tutor.dart
      - .github/workflows/Genesis.yml

jobs:
  gerar_artefatos:
    runs-on: ubuntu-latest

    steps:
      - name: 📦 Checkout do grimório
        uses: actions/checkout@v3

      - name: 🧙 Instalar Dart
        uses: dart-lang/setup-dart@v1

      - name: 🔮 Executar TutorDemoníaco
        run: dart run bin/tutor.dart

      - name: 🔍 Listar artefatos gerados
        id: listar
        run: |
          echo "ARTS=$(ls artefatos/*.dart | xargs)" >> $GITHUB_ENV

  processar_artefatos:
    needs: gerar_artefatos
    runs-on: ubuntu-latest
    strategy:
      matrix:
        artefato: [${{ env.ARTS }}]

    steps:
      - name: 📦 Checkout do grimório
        uses: actions/checkout@v3

      - name: 📁 Mover artefato para LIMBO
        run: |
          mkdir -p lib/limbo/
          cp ${{ matrix.artefato }} lib/limbo/

      - name: 🧪 Testar ritual
        run: |
          mkdir -p lib/limbo/testes/
          cp ${{ matrix.artefato }} lib/limbo/testes/
          echo "🔬 Testes simulados para ${{ matrix.artefato }}"

      - name: 🧬 Simular ritual
        run: |
          mkdir -p lib/limbo/simulacoes/
          cp ${{ matrix.artefato }} lib/limbo/simulacoes/
          echo "🌀 Simulações concluídas para ${{ matrix.artefato }}"

      - name: 📜 Validar ritual
        run: |
          echo "✅ Ritual validado: ${{ matrix.artefato }}"
          gh workflow run Validação.yml || (
            echo "❌ Falha na validação. Movendo para INFERNUS..."
            mkdir -p lib/infernus/
            mv ${{ matrix.artefato }} lib/infernus/
          )

# Sugestões
# - 🔁 Adicionar logs ritualísticos por artefato
# - 🧩 Integrar com GRIMORIO após validação
# - 🛡️ Criar rollback para rituais corrompidos

# ✍️ byThyrrel  
# 💡 Formato grimório técnico seguro e elegante
