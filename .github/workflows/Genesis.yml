name: 🌌 Genesis - Criação e Validação de Rituais

on:
  workflow_dispatch:

jobs:
  tutor:
    name: 🧙‍♂️ Tutor-Demoniaco - Processar Recipes
    runs-on: ubuntu-latest

    steps:
      - name: Checkout do repositório
        uses: actions/checkout@v3

      - name: Configurar Git
        run: |
          git config --global user.name "Tutor-Demoniaco"
          git config --global user.email "ritual@vdf.com"

      - name: Processar arquivos em recipes/
        run: |
          for file in Tutor-Demoniaco/recipes/*.txt; do
            nome=$(grep '^nome:' "$file" | cut -d':' -f2 | xargs)
            tipo=$(grep '^tipo:' "$file" | cut -d':' -f2 | xargs)
            descricao=$(grep '^descricao:' "$file" | cut -d':' -f2- | xargs)

            echo "🔧 Criando artefato: $nome ($tipo)"
            echo "📜 Descrição: $descricao"

            mkdir -p instrumentos_magicos
            echo "void main() => print('Executando $nome: $descricao');" > instrumentos_magicos/$nome.dart

            mkdir -p .github/workflows
            {
              echo "name: 🔥 $nome - Validação em LIMBO"
              echo "on:"
              echo "  push:"
              echo "    branches:"
              echo "      - LIMBO"
              echo "jobs:"
              echo "  testar_$nome:"
              echo "    name: 🧪 Testar $nome"
              echo "    runs-on: ubuntu-latest"
              echo "    steps:"
              echo "      - name: Checkout"
              echo "        uses: actions/checkout@v3"
              echo "      - name: Instalar Dart"
              echo "        uses: dart-lang/setup-dart@v1"
              echo "      - name: Executar $nome.dart"
              echo "        run: dart instrumentos_magicos/$nome.dart"
            } > .github/workflows/$nome.yml

            git fetch origin LIMBO
            git checkout LIMBO
            git pull origin LIMBO
            git add instrumentos_magicos/$nome.dart .github/workflows/$nome.yml
            git commit -m "✨ Ritual $nome criado pelo Tutor e enviado para LIMBO"
            git push origin LIMBO
          done
