# ‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì
# ‚îÉ üåå extraplanares.yml ‚Äì Ritual de invoca√ß√£o dimensional                                   ‚îÉ
# ‚îÉ üìú Executa rituais aprovados na branch ExtraPlanares                                     ‚îÉ
# ‚îÉ üîí Registra no README e comita com identidade ritual√≠stica                               ‚îÉ
# ‚îó‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îõ

name: Ritual ExtraPlanares

on:
  workflow_dispatch:
  push:
    branches: [ExtraPlanares]
    paths:
      - extraplanar/*.dart
      - .github/workflows/extraplanares.yml
      - README.md

permissions:
  contents: write

jobs:
  invocacao:
    name: Invoca√ß√£o Dimensional
    runs-on: ubuntu-latest
    steps:
      - name: Checkout da branch ExtraPlanares
        uses: actions/checkout@v4
        with:
          ref: ExtraPlanares

      - name: Instalar Dart
        uses: dart-lang/setup-dart@v1

      - name: Detectar e invocar √∫ltimo ritual
        id: ritual
        run: |
          ultimo=$(find extraplanar -maxdepth 1 -type f -name '*.dart' | sort | tail -n 1)
          nome=$(basename "$ultimo" .dart)
          echo "Invocando: $nome"
          dart run "$ultimo" || echo "// falha ignorada"
          echo "ritual_nome=$nome" >> $GITHUB_OUTPUT
          echo "$nome" > .ritual_atual.txt

      - name: Registrar no README.md
        run: |
          nome=$(cat .ritual_atual.txt)
          grep -q "## Rituais" README.md || echo -e "\n## Rituais" >> README.md
          grep -q "^- $nome" README.md || sed -i "/## Rituais/a - $nome" README.md

      - name: Commit autom√°tico
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Ritual extraplanar invocado: ${{ steps.ritual.outputs.ritual_nome }}"
          branch: ExtraPlanares
          file_pattern: README.md
          commit_user_name: ritual-bot
          commit_user_email: ritual@bot.com
